<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width" />
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <title>首页</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../css/index.css" />
    <link rel="stylesheet" type="text/css" href="../css/swiper.min.css">
    <link rel="stylesheet" type="text/css" href="../css/jianpan.css" />
    <style>
        .txt-scroll {
            width: 100%;
            height: 39px;
            line-height: 39px;
        }

        .txt-scroll .scrollbox {
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            transition: all .2s;
        }

        .txt-scroll .txt,
        .txt-scroll .txt-clone {
            display: inline;
            position: relative;
            line-height: 48px;
        }

        .clear {
            clear: both;
            height: 0;
        }

        .gcaidjh_ge .gcaidjh_gex {
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 0.3rem;
            width: 90%;
            margin: 5px auto;
        }

        .gcaidjh_ge .gcaidjh_gex cite {
            font-size: 0.8rem;
            color: #333;
        }

        .gcaidjh_ge .gcaidjh_gex address ruby {
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.2rem;
            padding-left: 0.3rem;
            padding-right: 0.3rem;
            height: 0.5rem;
            line-height: 0.48rem;
            border-radius: 1000rem;
            font-size: 0.24rem;
            color: #56c956;
            border: 1px solid #56c956;
            margin-top: 0.2rem;
        }

        .gcaidjh_ge .gcaidjh_gex address ruby:last-child {
            margin-right: 0;
        }

        .gcaidjh_ge .gcaidjh_gex address ruby {
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.2rem;
            padding-left: 10px;
            padding-right: 10px;
            height: 29px;
            line-height: 29px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #56c956;
            border: 1px solid #56c956;
            margin-top: 0.2rem;
        }

        .gcaidjh_ge .gcaidjh_gex address ruby.on {
            background: #56c956;
            color: #fff;
        }

        .daily_img img {
            margin-top: 7px;
            margin-left: -4px;
        }

        .gcaidjimg_poi {
            height: 100px;
            margin: auto;
            /*width:100%;*/
        }

        .gcaidjh_xs {
            float: right;
            width: 35px;
            height: 35px;
            line-height: 35px;
            text-align: center;
            margin-right: 1%;
            margin-top: 9.5px;
            overflow: hidden;
        }

        .gcaidjh_xs img {
            width: 30px;
        }

        .gcaidjh_xs_box {
            padding: 10px 0;
        }

        .gcaidjh_xs_box,
        .title_left,
        .title_right {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .title_img {
            width: 25px;
            height: 22px;
        }

        .title_img img {
            width: 25px;
            height: 22px;
        }

        .title_left {
            margin-right: 8px;
        }

        .title_txt {
            display: inline-block;
            font-size: 0.9rem;
            font-weight: 600;
            color: #ee4e3a;
            margin-left: 5px;
        }

        .title_right {
            font-size: 0.7rem
        }

        .title-time-txt {
            margin-right: 5px;
        }
    </style>
</head>

<body>
    <header class="aui-bar aui-bar-nav aui-bar-light" id="header" style="    position: fixed;top: 0;left: 0;z-index: 99999999999999;height: 3.5rem;background:transparent;">
        <div class="aui-title" style="left:2rem; right: 0.5rem;">
            <div class="aui-searchbar" style="background:transparent;">
                <div class="aui-searchbar-input aui-border-radius">
                    <i class="aui-iconfont aui-icon-search"></i>
                    <input type="search" placeholder="请输入搜索内容" id="search-input" tampode onclick="openSearch()">
                    <div class="aui-searchbar-clear-btn">
                        <i class="aui-iconfont aui-icon-close"></i>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- 轮播图 -->
    <div class="swiper-container" style="height: 210px;">
        <div class="swiper-wrapper">
            <div class="swiper-slide"><img src="../image/lun1.png" alt="" width="100%" height="100%"></div>
            <div class="swiper-slide"><img src="../image/lun2.png" alt="" width="100%" height="100%"></div>
        </div>
        <div class="swiper-pagination"></div>
    </div>
    <!-- 导航栏 -->
    <div class="gcaidjh_zd"></div>
    <!-- 公告 -->
    <div class="gong">
        <div class="gao">
            <div class="gao_img"><img src="../image/gcaidj_pic4.png" width="30px" height="30px" /></div>
            <div class="gao_con">
                <div class="txt-scroll txt-scroll-default">
                    <div class="scrollbox">
                        <div class="txt publicMsg">
                            深圳市移联天下电子商务有限公司成立于2014年， 是集移动互联网新消费模式、品质消费体验、社交分享于一体的会员权益服务平台。
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 图片 -->
    <div class="imgs"><img class="image" src="../image/lun2.png" alt="" width="100%" height="100%"></div>

    <!-- 限时 -->
    <div class="gcaidjh_jx" id="gcaidjh_xs">
        <div class="gcaidjh_xs_box">
            <div class="title_left">
                <div class="title_img">
                    <img src="../image/gcaidj_pic17.png" alt="">
                </div>
                <div class="title_txt">
                    限时特惠
                </div>
            </div>
            <div class="title_right">
                <div class="title-time-txt" id="time_txt"></div>
                <div class="title-time" id="time_limit"></div>
            </div>
        </div>
        <ol id="list_time">
            <!-- <li>
                <section class="gcaidjh_jxb">
                    <a href="#/details?id=19765" class="" tampode onclick="openGood()">
                        <cite>黎蒿</cite>
                        <div class="gcaidjimg_po">
                            <img src="../image/Jzz5770Jj9wr2w3P3MJXsK33X2A78jdOF9rgei0X.jpeg" alt="" class="gcaidjimg_poi">
                            <span class="daily_img">
                              <img src="../image/726Yn0GUJ6U7KgPTC2J1SLWCkNao00BIpxk4ArdO.png" alt="">
                            </span>
                            <span class="daily_xi">
                            <span></span>
                            <strong class="daily_xis">扶贫</strong>
                            </span>
                        </div>
                    </a>
                    <section class="clear"></section>
                    <div style="margin-top:10px;">
                        <section class="gcaidjh_jxl">
                            <aside class="vueappsy_add on">含税价:40</aside>
                            <address class="gcaidjh_jxb_m">￥38.00元/斤</address>
                        </section>
                        <section data-id="19765" class="gcaidjh_xs" tampode onclick="fnOpenShopCar();">
                            <i class="iconfont"><img src="../image/time_jt.png" alt=""></i>
                        </section>
                    </div>
                    <section class="clear"></section>
                </section>
            </li> -->
        </ol>
    </div>

    <!-- 商品 -->
    <div class="gcaidjh_jx">
        <h3><img src="../image/gcaidj_pic5.png" alt=""><span>今日精选</span></h3>
        <ol id="list">
            <!-- <li>
                <section class="gcaidjh_jxb">
                    <a href="#/details?id=19765" class="" tampode onclick="openGood()">
                        <cite>黎蒿</cite>
                        <div class="gcaidjimg_po">
                            <img src="../image/Jzz5770Jj9wr2w3P3MJXsK33X2A78jdOF9rgei0X.jpeg" alt="" class="gcaidjimg_poi">
                            <span class="daily_img">
                              <img src="../image/726Yn0GUJ6U7KgPTC2J1SLWCkNao00BIpxk4ArdO.png" alt="">
                            </span>
                            <span class="daily_xi">
                            <span></span>
                            <strong class="daily_xis">扶贫</strong>
                            </span>
                        </div>
                    </a>
                    <section class="clear"></section>
                    <div style="margin-top:10px;">
                        <section class="gcaidjh_jxl">
                            <aside class="vueappsy_add on">含税价:40</aside>
                            <address class="gcaidjh_jxb_m">￥38.00元/斤</address>
                        </section>
                        <section data-id="19765" class="gcaidjh_jxr" tampode onclick="fnOpenShopCar();">
                            <i class="iconfont"><img src="../image/shopcar.jpg" alt=""></i>
                        </section>
                    </div>
                    <section class="clear"></section>
                </section>
            </li> -->
        </ol>
    </div>
    <!-- 上拉加载 -->
    <div id="up">上拉加载更多</div>
    <!-- 底部 -->
    <footer class="aui-bar aui-bar-tab dbbk" id="foot" style="border-top: 1px solid #f5f0f0;">
        <div class="aui-bar-tab-item aui-active">
            <img src="../image/home.jpg">
            <div class="aui-bar-tab-label">首页</div>
        </div>
        <div class="aui-bar-tab-item" tampode onclick="openClassify()">
            <img src="../image/fenlei1.jpg">
            <div class="aui-bar-tab-label">分类</div>
        </div>
        <div class="aui-bar-tab-item" tampode onclick="openShopCart()">
            <img src="../image/car1.jpg">
            <div class="aui-bar-tab-label">购物车</div>
        </div>
        <div class="aui-bar-tab-item" tampode onclick="openOrder()">
            <img src="../image/dingdan.jpg">
            <div class="aui-bar-tab-label">订单</div>
        </div>
        <div class="aui-bar-tab-item" tampode onclick="openMine()">
            <img src="../image/wode1.jpg">
            <div class="aui-bar-tab-label">我的</div>
        </div>
    </footer>
    <!--页面的遮罩层-->
    <div id="cover"></div>
    <!--页面的弹出框-->
    <div id="modal" class="gcaidjh_ge" style="height:auto;">
        <div class="#modalb">
            <input type="hidden" id="attr_id" value="0">
            <section class="gcaidjh_gei">
                <section class="gcaidjh_gei_l goodsImage">

                </section>
                <section class="gcaidjh_gei_o">
                    <cite class="title">黄豆芽</cite>
                    <address class="vueappsy_add describe">清热解毒,利尿除湿</address>
                    <aside class="gcaidjd_djg price">￥0.00元/斤</aside>
                </section>
                <section class="gcaidjh_gei_r" tampode onclick="closeWin()"><img src="../image/gcaidj_pic6.png" alt=""></section>
                <section class="clear"></section>
            </section>
            <section class="clear"></section>
            <section class="gcaidjh_gex attrListParents">
                <cite>选择规格</cite>
                <address class="attrList">
                  <ruby data-id="1680" data-jiage="2.00" data-yuanjia="0" data-guige="斤" class="mores"> 斤</ruby>
                  <ruby data-id="1681" data-jiage="6.00" data-yuanjia="0" data-guige="斤" class="mores">空心菜</ruby>
                </address>
            </section>
            <section class="clear"></section>
            <section class="gcaidjh_geg">
                <cite>购买数量</cite>
                <section class="gcaidj_sl gcaidj_sg">
                    <ruby data-class="gcaidj_sg" class="gcaidj_sls gcaidj_sln" onclick="reduce();">
                      <img src="../image/gcaidj_pic7.png" alt="">
                    </ruby>
                    <input type="text" value="1" readonly class="gcaidj_sli itemNum t-keybord isFloat" data-float="1">
                    <ruby data-class="gcaidj_sg" class="gcaidj_sla" onclick="add();">
                      <img src="../image/gcaidj_pic8.png" alt="">
                    </ruby>
                </section>
            </section>
            <button type="button" class="confirm" style="position:relative;">确定</button>
        </div>
    </div>
    <!-- 数值键盘遮罩层 -->
    <div id="coverd"></div>
    <div id="t-keybord">
        <div class="numbers-content">
            <div class="numbers-txt-ba2">
                <!-- <div class="numbers-title">最大数量<span class="sum">999</span></div> -->
            </div>
            <div class="numbers-txt-ba">
                <div class="numbers-txt-box"><span class="numbers-txts"></span><em class="numbers-txte">0</em></div>
                <div class="numbers-txt-cler">
                    <div class="clear-text" id="t-del"><img src="../image/del1.png" alt=""></div>
                </div>
            </div>
            <div class="clear"></div>
            <div class="numbers-txt-ba1">
                <div class="numbers-btn-group">
                    <button type="button" value="11" class="sum-btn-value">1</button>
                    <button type="button" value="2" class="sum-btn-value">2</button>
                    <button type="button" value="3" class="sum-btn-value">3</button>
                    <button type="button" value="4" class="sum-btn-value">4</button>
                    <button type="button" value="5" class="sum-btn-value">5</button>
                    <button type="button" value="6" class="sum-btn-value">6</button>
                    <button type="button" value="7" class="sum-btn-value">7</button>
                    <button type="button" value="8" class="sum-btn-value">8</button>
                    <button type="button" value="9" class="sum-btn-value">9</button>
                    <button type="button" value="0" class="sum-btn-value">0</button>
                    <button type="button" value="." class="sum-btn-value wrap_xsd">.</button>
                    <button type="button" value="" class="sum-btn-value"></button>
                    <!-- <span class="wrap_ys"></span> -->
                    <spanclass="wrap_xsd1" style="display: none;">
                        </span>
                </div>
                <div class="cifg-btn">
                    <div class="cifg-btn-confirm modifymi_qk" id="t-clear">清空</div>
                    <div class="cifg-btn-confirm cancel-btn" id="t-close">取消</div>
                    <div class="clear"></div>
                    <div class="cifg-btn-confirm1 modifymi_con" id="t-submit">确认</div>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="../script/swiper.min.js"></script>
<script type="text/javascript" src="../script/txtscroll.js"></script>
<script type="text/javascript" src="../script/encipherment.js"></script>
<script type="text/javascript" src="../script/md5.js"></script>
<script type="text/javascript" src="../script/regular.js"></script>
<script type="text/javascript" src="../script/date.js"></script>
<script type="text/javascript" src="../script/logout.js"></script>
<script type="text/javascript" src="../script/sshuzijianpan.js"></script>
<script type="text/javascript">
    var itemNum = '';
    var attrList = '';
    var is_activity = '';
    var activity_num = '';
    var activity_price = '';
    var cart_num = '';
    var attr_price = '';
    var itemId, attrId = 0,
        falg = 0,
        skip = 0,
        LIMIT = 10,
        timeStamp = timestamp(); // falg标识是否含有规格
    apiready = function() {
        // 连点物理返回键退出APP
        ExitApp();
        //修改手机状态栏字体颜色
        api.setStatusBarStyle({
            style: 'dark'
        });
        //头部沉浸式效果
        var header = $api.byId('header');
        var foot = $api.byId('foot');
        $api.fixStatusBar(header);
        //定义微信appid
        $api.setStorage('APPID', 'wx50089ffa80a2ec23');
        $api.setStorage('URL', "http://mangguo.caidj.cn");
        $api.setStorage('appid', 1);
        api.showProgress({
            title: '努力加载中...',
            modal: false
        });
        //七．首页轮播图和导航按钮、公告
        var sign = getSign("appid=" + $api.getStorage("appid") + "&timeStamp=" + timeStamp);
        api.ajax({
            url: $api.getStorage("URL") + '/mobileOrder/indexAd',
            method: 'GET',
            data: {
                body: {
                    appid: $api.getStorage("appid"),
                    active: 2,
                    timeStamp: timeStamp,
                    sign: sign
                }
            }
        }, function(ret, err) {
            if (ret) {
                judgement(ret.code, ret.msg)
                if (ret.code == 200) {
                    tel = ret.data.phone;
                    //轮播图
                    var ads = ret.data.ad;
                    // 无数据显示默认轮播图
                    if (ads.length > 0) {
                        var adStr = "";
                        for (var i = 0; i < ads.length; i++) {
                            adStr += "<div class='swiper-slide'><img src='" + $api.getStorage("URL") + ads[i].banner + "' width='100%' height='100%'></div>";
                        }
                        $api.html($api.dom(".swiper-wrapper"), adStr);
                        // 轮播图
                        scrollPictures();
                    }
                    //导航按钮
                    var navs = ret.data.nav;
                    if (navs.length > 0) {
                        navStr = "";
                        for (var i = 0; i < navs.length; i++) {
                            if (navs[i].id >= 1 && navs[i].id <= 8) {
                                navStr += "<div onclick='toPage(" + navs[i].id + "," + navs[i].cate_id + "," + navs[i].status + ");'><img src='" + $api.getStorage("URL") + "/" + navs[i].img_url + "'> <cite>" + navs[i].title +
                                    "</cite></div>";
                            } else {
                                navStr += "<div onclick='toPage(" + navs[i].id + "," + navs[i].cate_id + "," + navs[i].status + ");'><img src='" + $api.getStorage("URL") + navs[i].img_url + "'> <cite>" + navs[i].title + "</cite></div>"
                            }
                        }
                        $api.html($api.dom(".gcaidjh_zd"), navStr);
                    } else {
                        // 无数据默认不显示
                        $api.css($api.dom(".gcaidjh_zd"), 'display:none');
                    }
                    //公告
                    $api.html($api.dom(".publicMsg"), ret.data.public_msg);
                    $('.txt-scroll-default').txtscroll({
                        'speed': 50
                    });
                    // 中部导航图
                    if (isNotEmpry(ret.data.banner4)) {
                        $api.attr($api.dom(".image"), 'src', $api.getStorage("URL") + ret.data.banner4);
                    } else {
                        $api.css($api.dom(".imgs"), 'display:none');
                    }
                } else {
                    api.toast({
                        msg: ret.msg,
                        duration: 3000,
                        location: 'middle'
                    });
                }
            } else {
                api.toast({
                    msg: JSON.stringify(err),
                    duration: 2000,
                    location: 'middle'
                });
            }
            api.hideProgress();
        });
        // 获取数据
        fnGetWareList();
        // 获取限时数据
        xsList();

        // 监听底部
        loadMore();
        // 监听屏幕滑动
        $(window).scroll(function() {
            $('body').bind('touchmove', function(e) {
                var winHeight = $(window).scrollTop();
                if (winHeight >= 120) {
                    $("#header").css("background", "white");
                    $(".aui-searchbar").css("background", "white");
                } else {
                    $("#header").css("background", "transparent");
                    $(".aui-searchbar").css("background", "transparent");
                }
            });
        });
        // 添加购物车
        $api.addEvt($api.dom(".confirm"), 'click', function() {
            if (isNotEmpry($api.getStorage('token'))) {
                if (falg == 1 && attrId == 0) {
                    api.toast({
                        msg: "请选择规格",
                        duration: 2000,
                        location: 'middle'
                    });
                    return;
                }
                itemNum = $api.val($api.dom(".itemNum"));
                api.showProgress({
                    title: '努力加载中...',
                    modal: false
                });
                var timeStamp = timestamp();
                var sign = getSign("appid=" + $api.getStorage("appid") + "&attr_id=" + attrId + "&item_num=" + itemNum + "&item_id=" + itemId + "&timeStamp=" + timeStamp);
                api.ajax({
                    url: $api.getStorage("URL") + '/mobileOrder/firstChangeNum',
                    method: 'POST',
                    headers: {
                        'Authorization': $api.getStorage('token')
                    },
                    returnAll: true,
                    data: {
                        values: {
                            appid: $api.getStorage("appid"),
                            active: 2,
                            attr_id: attrId,
                            item_num: itemNum,
                            item_id: itemId,
                            timeStamp: timeStamp,
                            sign: sign
                        }
                    }
                }, function(ret, err) {
                    if (ret) {
                        judgement(ret.body.code, ret.msg)
                        var body = ret.body;
                        var headers = ret.headers;
                        if (isNotEmpry(headers.Authorization)) {
                            $api.setStorage('token', headers.Authorization);
                        }
                        if (body.code == 200) {
                            api.toast({
                                msg: body.msg,
                                duration: 2000,
                                location: 'middle'
                            });
                            falg = 0;
                            $("#cover").hide();
                            $("#modal").hide();
                            $("body").css("overflow", "auto");
                        } else {
                            api.toast({
                                msg: body.msg,
                                duration: 2000,
                                location: 'middle'
                            });
                        }
                    } else {
                        api.toast({
                            msg: JSON.stringify(err),
                            duration: 2000,
                            location: 'middle'
                        });
                    }
                    api.hideProgress();
                });
            } else {
                api.openWin({
                    name: 'login',
                    url: 'login.html',
                    reload: true,
                    slidBackEnabled: false
                });
            }
        });
    };
    //轮播图
    function scrollPictures() {
        var swiper = new Swiper('.swiper-container', {
            loop: true,
            autoplay: true,
            pagination: {
                el: '.swiper-pagination',
            },
        });
    }
    // 监听底部
    function loadMore() {
        api.addEventListener({
            name: 'scrolltobottom',
            extra: {
                threshold: -200
            }
        }, function(ret, err) {
            api.showProgress({
                title: '努力加载中...',
                modal: false
            });
            fnGetWareList(true);
            api.hideProgress();
        });
    }


    // 获取限时抢购数据
    function xsList() {
        var sign = getSign("appid=" + $api.getStorage("appid") + "&timeStamp=" + timeStamp);
        // 获取首页商品
        api.ajax({
            url: $api.getStorage("URL") + '/mobileOrder/panicBuyIndex',
            method: 'GET',
            headers: {
                'Authorization': $api.getStorage('token')
            },
            returnAll: true,
            data: {
                body: {
                    appid: $api.getStorage("appid"),
                    timeStamp: timeStamp,
                    sign: sign
                }
            }
        }, function(ret, err) {
            // console.log(JSON.stringify(ret));
            if (ret) {
                judgement(ret.body.code, ret.msg)
                var body = ret.body;
                var headers = ret.headers;
                if (isNotEmpry(headers.Authorization)) {
                    $api.setStorage('token', headers.Authorization);
                }
                if (body.code == 200) {
                    var list = body.data.itemList;
                    var listStr = "";
                    if (body.data != '') {
                        for (var i = 0; i < list.length; i++) {
                            listStr += "<li>";
                            listStr += "<section class='gcaidjh_jxb'>";
                            listStr += "<a href='javascript:void(0);' tampode onclick='openGood(" + body.data.is_detail + "," + list[i].item_id + ");'>";
                            listStr += "<cite>" + list[i].item_title + "</cite>";
                            listStr += "<div class='gcaidjimg_po'>";
                            if (isNotEmpry(list[i].img)) {
                                listStr += "<img onload='fnLoadImage(this);' data-url='" + $api.getStorage("URL") + list[i].img + "' src='' class='gcaidjimg_poi' alt='暂无图片' onerror='onerrors(this,\"" + body.data.item_default + "\");'>";
                            } else {
                                listStr += "<img onload='fnLoadImage(this);' data-url='" + $api.getStorage("URL") + body.data.item_default + "' src='' class='gcaidjimg_poi' alt='暂无图片' onerror='onerrors(this,\"" + body.data.item_default +
                                    "\");'>";
                            }
                            listStr += "<span class='daily_img'>";
                            // 判断水印是否显示 0否1是
                            if (body.data.shuiyin == 1) {
                                listStr += "<img src='" + $api.getStorage("URL") + body.data.logo + "'>";
                            }
                            listStr += "</span>";
                            // 判断右上角文字 数据为空则不显示
                            if (isNotEmpry(list[i].label)) {
                                listStr += "<span class='daily_xi'>";
                                listStr += "<span></span>";
                                listStr += "<strong class='daily_xis'>" + list[i].label.substr(0, 2) + "</strong>";
                                listStr += "</span>";
                            }
                            listStr += "</div>";
                            listStr += "</a>";
                            listStr += "<section class='clear'></section>";
                            listStr += "<div style='margin-top:10px;'>";
                            listStr += "<section class='gcaidjh_jxl'>";
                            if (isNotEmpry(list[i].describe)) {
                                listStr += "<aside class='vueappsy_add on'>" + list[i].describe + "</aside>";
                            } else {
                                listStr += "<aside class='vueappsy_add on'></aside>";
                            }
                            listStr += "<address class='gcaidjh_jxb_m'>￥" + list[i].activity_price + "元/" + list[i].unit + "</address>";
                            listStr += "</section>";
                            listStr += "<section class='gcaidjh_xs' tampode onclick='toSpike();'>";
                            listStr += "<i class='iconfont'><img src='../image/time_jt.png'></i>"
                            listStr += "</section>";
                            listStr += "</div>";
                            listStr += "<section class='clear'></section>";
                            listStr += "</section>";
                            listStr += "</li>";
                        }

                        var list = $api.byId('list_time');
                        $api.append(list, listStr);
                        // 获取倒计时数据
                        timew(body.data.timeRemain, body.data.activity_status);
                    } else {
                        $('#gcaidjh_xs').hide();
                    }


                } else {
                    api.toast({
                        msg: body.msg,
                        duration: 2000,
                        location: 'middle'
                    });
                }

            } else {
                api.toast({
                    msg: JSON.stringify(err),
                    duration: 2000,
                    location: 'middle'
                });
            }
        });
    }


    // 时分
    function timew(data, status) {
        var time1 = data;
        var time = ptime(data);
        if (status == 0) {
            var list = $api.byId('time_txt');
            $api.append(list, "离开始");
        } else if (status == 1) {
            var list = $api.byId('time_txt');
            $api.append(list, "离结束");
        }
        var tim = setInterval(function() {
            if (Math.abs(time1) - 1 != 0) {
                time = ptime(Math.abs(time1) - 1);
                time1 = Math.abs(time1) - 1;
                var list = $api.byId('time_limit');
                $api.html(list, time);
            } else {
                clearInterval(tim);
                time = '';
                time1 = 0;
                var sign = getSign("appid=" + $api.getStorage("appid") + "&timeStamp=" + timeStamp);
                api.ajax({
                    url: $api.getStorage("URL") + '/mobileOrder/panicBuyIndex',
                    method: 'GET',
                    headers: {
                        'Authorization': $api.getStorage('token')
                    },
                    returnAll: true,
                    data: {
                        body: {
                            appid: $api.getStorage("appid"),
                            active: 2,
                            timeStamp: timeStamp,
                            sign: sign
                        }
                    }
                }, function(ret, err) {
                    if (ret) {
                        judgement(ret.body.code, ret.msg)
                        var body = ret.body;
                        var headers = ret.headers;
                        if (isNotEmpry(headers.Authorization)) {
                            $api.setStorage('token', headers.Authorization);
                        }
                        if (body.code == 200) {
                            //  alert(1)
                            // alert(body.data);
                            var time2 = body.data;
                            time = ptime(time2.timeRemain);
                            time1 = time2.timeRemain;
                            var status1 = time2.activity_status

                            if (time2.activity_status) {
                                if (status1 == 0) {
                                    var list = $api.byId('time_txt');
                                    $api.html(list, "离开始");
                                } else if (status1 == 1) {
                                    var list = $api.byId('time_txt');
                                    $api.html(list, "离结束");
                                }
                                //  var list = $api.byId('time_limit');
                                //  $api.append(list, time);
                                timew(time2.timeRemain, time2.activity_status);
                            } else if (!time2.activity_status) {
                                $('#gcaidjh_xs').hide();
                            }



                        } else {
                            api.toast({
                                msg: body.msg,
                                duration: 2000,
                                location: 'middle'
                            });
                        }

                    } else {
                        api.toast({
                            msg: JSON.stringify(err),
                            duration: 2000,
                            location: 'middle'
                        });
                    }
                });

            }
        }, 1000)
    }

    //获取数据
    function fnGetWareList(loadMore_) {
        if (loadMore_) {
            skip++;
        } else {
            skip = 0;
        }
        var sign = getSign("appid=" + $api.getStorage("appid") + "&timeStamp=" + timeStamp);
        // 获取首页商品
        api.ajax({
            url: $api.getStorage("URL") + '/mobileOrder/indexItem',
            method: 'GET',
            headers: {
                'Authorization': $api.getStorage('token')
            },
            returnAll: true,
            data: {
                body: {
                    appid: $api.getStorage("appid"),
                    active: 2,
                    timeStamp: timeStamp,
                    page: skip + 1,
                    num: LIMIT,
                    sign: sign
                }
            }
        }, function(ret, err) {
            if (ret) {
                judgement(ret.body.code, ret.msg)
                var body = ret.body;
                var headers = ret.headers;
                if (isNotEmpry(headers.Authorization)) {
                    $api.setStorage('token', headers.Authorization);
                }
                if (body.code == 200) {

                    var list = body.data.list;
                    // console.log(JSON.stringify(list))
                    if (isNotEmpry(list) && list.length > 0) {
                        var listStr = "";
                        for (var i = 0; i < list.length; i++) {
                            listStr += "<li>";
                            listStr += "<section class='gcaidjh_jxb'>";
                            listStr += "<a href='javascript:void(0);' tampode onclick='openGood(" + body.data.is_detail + "," + list[i].id + ");'>";
                            listStr += "<cite>" + list[i].title + "</cite>";
                            listStr += "<div class='gcaidjimg_po'>";
                            if (isNotEmpry(list[i].img)) {
                                listStr += "<img onload='fnLoadImage(this);' data-url='" + $api.getStorage("URL") + list[i].img + "' src='' class='gcaidjimg_poi' alt='暂无图片' onerror='onerrors(this,\"" + body.data.item_default + "\");'>";
                            } else {
                                listStr += "<img onload='fnLoadImage(this);' data-url='" + $api.getStorage("URL") + body.data.item_default + "' src='' class='gcaidjimg_poi' alt='暂无图片' onerror='onerrors(this,\"" + body.data.item_default +
                                    "\");'>";
                            }
                            listStr += "<span class='daily_img'>";
                            // 判断水印是否显示 0否1是
                            if (body.data.shuiyin == 1) {
                                listStr += "<img src='" + $api.getStorage("URL") + body.data.logo + "'>";
                            }
                            listStr += "</span>";
                            // 判断右上角文字 数据为空则不显示
                            if (isNotEmpry(list[i].label)) {
                                listStr += "<span class='daily_xi'>";
                                listStr += "<span></span>";
                                listStr += "<strong class='daily_xis'>" + list[i].label.substr(0, 2) + "</strong>";
                                listStr += "</span>";
                            }
                            listStr += "</div>";
                            listStr += "</a>";
                            listStr += "<section class='clear'></section>";
                            listStr += "<div style='margin-top:10px;'>";
                            listStr += "<section class='gcaidjh_jxl'>";
                            if (isNotEmpry(list[i].describe)) {
                                listStr += "<aside class='vueappsy_add on'>" + list[i].describe + "</aside>";
                            } else {
                                listStr += "<aside class='vueappsy_add on'></aside>";
                            }
                            // 判断是否可以查看价格 0否1是
                            if (body.data.is_look == 1) {
                                if (isNotEmpry(list[i].attr)) {
                                    if (list[i].market_price == 1) {
                                        // 参与时价
                                        listStr += "<address class='gcaidjh_jxb_m'>￥时价</address>";
                                    } else {
                                        listStr += "<address class='gcaidjh_jxb_m'>￥" + list[i].area_price + "</address>";
                                    }

                                } else {
                                    // 判断该商品是否参与活动 0否1是 如果是则显示活动价格
                                    if (list[i].is_activity == 1) {
                                        listStr += "<address class='gcaidjh_jxb_m'>￥" + list[i].activity_price + "元/" + list[i].unit + "</address>";
                                    } else {
                                        // 如果没有参与活动 则判断是否开启时价 0否1是
                                        if (list[i].market_price == 1) {
                                            // 参与时价
                                            listStr += "<address class='gcaidjh_jxb_m'>￥时价</address>";
                                        } else {
                                            listStr += "<address class='gcaidjh_jxb_m'>￥" + list[i].price + "元/" + list[i].unit + "</address>";
                                        }
                                    }
                                }
                            } else {
                                listStr += "<address class='gcaidjh_jxb_m'>￥***</address>";
                            }
                            listStr += "</section>";
                            listStr += "<section class='gcaidjh_jxr' tampode onclick='fnOpenShopCar(" + list[i].id + ");'>";
                            listStr += "<i class='iconfont'><img src='../image/shopcar.jpg'></i>";
                            listStr += "</section>";
                            listStr += "</div>";
                            listStr += "<section class='clear'></section>";
                            listStr += "</section>";
                            listStr += "</li>";
                        }
                        var list = $api.byId('list');
                        if (loadMore_) {
                            $api.append(list, listStr);
                        } else {
                            $api.html(list, listStr);
                        }
                    } else {
                        $api.html($api.dom("#up"), '没有数据啦！');
                    }
                } else {
                    api.toast({
                        msg: body.msg,
                        duration: 2000,
                        location: 'middle'
                    });
                }

            } else {
                api.toast({
                    msg: JSON.stringify(err),
                    duration: 2000,
                    location: 'middle'
                });
            }
        });
    }
    // 加入购物车
    function fnOpenShopCar(id) {
        api.showProgress({
            title: '努力加载中...',
            modal: false
        });
        var timeStamp = timestamp();
        var sign = getSign("appid=" + $api.getStorage("appid") + "&id=" + id + "&timeStamp=" + timeStamp);
        api.ajax({
            url: $api.getStorage("URL") + '/mobileOrder/getItemById',
            method: 'GET',
            headers: {
                'Authorization': $api.getStorage('token')
            },
            returnAll: true,
            data: {
                values: {
                    appid: $api.getStorage("appid"),
                    active: 2,
                    id: id,
                    timeStamp: timeStamp,
                    sign: sign
                }
            }
        }, function(ret, err) {
            if (ret) {
                judgement(ret.body.code, ret.msg)
                var body = ret.body;
                var headers = ret.headers;
                if (isNotEmpry(headers.Authorization)) {
                    $api.setStorage('token', headers.Authorization);
                }
                if (body.code == 200) {
                    itemId = id;
                    var data = body.data;
                    // 是否可以输入小数
                    $api.attr($api.dom(".isFloat"), 'data-float', data.is_float);
                    $api.text($api.dom(".title"), data.title);
                    $api.text($api.dom(".describe"), data.describe);
                    $api.val($api.dom(".itemNum"), 1);
                    if (isNotEmpry(data.img)) {
                        $api.html($api.dom(".goodsImage"), "<img src='" + $api.getStorage("URL") + data.img + "' onerror='onerrors(this,\"" + data.item_default + "\");'>");
                    } else {
                        $api.html($api.dom(".goodsImage"), "<img src='" + $api.getStorage("URL") + data.item_default + "' onerror='onerrors(this,\"" + data.item_default + "\");'>");
                    }
                    // 判断是否显示价格
                    if (data.is_look == 1) {
                        // 判断是否含有属性
                        if (isNotEmpry(data.attr)) {
                            if (data.attr.is_activity == 1) {
                                $api.html($api.dom(".price"), data.area_price);
                            } else {
                                // 判断是否参与时价
                                if (data.attr.market_price == 1) {
                                    $api.html($api.dom(".price"), "￥时价");
                                } else {
                                    $api.html($api.dom(".price"), "￥" + data.area_price);
                                }
                            }
                        } else {
                            if (data.is_activity == 1) {
                                attr_price = data.price;
                                is_activity = data.is_activity;
                                activity_num = data.activity_num;
                                activity_price = data.activity_price;
                                cart_num = data.cart_num;

                                itemNum = $api.val($api.dom(".num"));
                                if ((Number(cart_num) + Number(itemNum)) > Number(activity_num)) {
                                  var txt = "￥" + data.price + "<del>￥" + data.price + "</del>"
                                  $api.html($api.dom(".price"), txt);
                                } else {
                                  var txt = "￥" + data.activity_price + "<del>￥" + data.price + "</del>"
                                  $api.html($api.dom(".price"), txt);
                                }


                            } else {
                                // 判断是否参与时价
                                if (data.market_price == 1) {
                                    $api.html($api.dom(".price"), "￥时价");
                                } else {
                                    $api.html($api.dom(".price"), "￥" + data.price);
                                }
                            }


                        }
                    } else {
                        $api.html($api.dom(".price"), "￥***");
                    }
                    attrList = data.attr;
                    // 规格
                    if (isNotEmpry(attrList)) {
                        falg = 1;
                        attrId = 0;
                        $api.css($api.dom(".attrListParents"), "display:block");
                        var listStr = "";
                        for (var i = 0; i < attrList.length; i++) {
                            listStr += "<ruby class='mores' is_activity='" + attrList[i].is_activity + "' cart_num='" + attrList[i].cart_num + "' activity_price='" + attrList[i].activity_price + "' activity_num='" + attrList[i].activity_num +
                                "' attr_id='" + attrList[i].id + "' attr_price='" + attrList[i].attr_price + "' market_price='" + attrList[i].market_price + "' onclick='mores(this);'>" + attrList[i].attr_title + "/" +
                                attrList[i].unit + "</ruby>"
                        }
                        $api.html($api.dom(".attrList"), listStr);
                    } else {
                        $api.css($api.dom(".attrListParents"), "display:none");
                    }
                    $("#cover").show();
                    $("#modal").show();
                    $("#cover").css("height", $(document.body).height());
                    $("body").css("overflow", "hidden");
                } else {
                    api.toast({
                        msg: body.msg,
                        duration: 2000,
                        location: 'middle'
                    });
                }
            } else {
                api.toast({
                    msg: JSON.stringify(err),
                    duration: 2000,
                    location: 'middle'
                });
            }
            api.hideProgress();
        });
    }
    // 增加数量
    function add() {
        itemNum = $api.val($api.dom(".itemNum"));
        if (itemNum < 999) {
            itemNum++;
            $api.val($api.dom(".itemNum"), itemNum);
        }
        cartActivityNum()
    }
    // 减少数量
    function reduce() {
        itemNum = $api.val($api.dom(".itemNum"));
        if (itemNum > 1) {
            itemNum--;
            $api.val($api.dom(".itemNum"), itemNum);
        }
        cartActivityNum()

    }

    function cartActivityNum() {
        // if (isNotEmpry(attrList)) {
        // console.log(Number(cart_num))
        if (is_activity == 1) {
            if ((Number(cart_num) + Number(itemNum)) > Number(activity_num)) {
              // console.log((Number(cart_num) + Number(itemNum)))
              console.log(Number(activity_num))
                var txt = "￥" + attr_price + "<del>￥" + attr_price + "</del>"
                $api.html($api.dom(".price"), txt);
            } else {
                var txt = "￥" + activity_price + "<del>￥" + attr_price + "</del>"
                $api.html($api.dom(".price"), txt);
            }
        }

        // }
    }
    // 选择规格
    function mores(obj) {
        $api.val($api.dom(".itemNum"), 1);
        $(".mores").removeClass("on");
        $(obj).addClass("on");
        attrId = $(obj).attr("attr_id");
        var market_price = $(obj).attr("market_price");
        attr_price = $(obj).attr("attr_price");
        is_activity = $(obj).attr("is_activity");
        activity_num = $(obj).attr("activity_num");
        activity_price = $(obj).attr("activity_price");
        cart_num = $(obj).attr("cart_num");
        if (is_activity == 1) {
          itemNum = $api.val($api.dom(".num"));
          if ((Number(cart_num) + Number(itemNum)) > Number(activity_num)) {
            var txt = "￥" + activity_price + "<del>￥" + attr_price + "</del>"
            $api.html($api.dom(".price"), txt);
          } else {
            var txt = "￥" + attr_price + "<del>￥" + attr_price + "</del>"
            $api.html($api.dom(".price"), txt);
          }
        } else {
            // 判断是否参与时价
            if (market_price == 1) {
                $api.html($api.dom(".price"), "￥时价");
            } else {
                $api.html($api.dom(".price"), "￥" + attr_price);
            }
        }
    }
    //关闭购物车弹窗
    function closeWin() {
        $("#cover").hide();
        $("#modal").hide();
        $("body").css("overflow", "auto");
        falg = 0;
    }
    // 图片缓存
    function fnLoadImage(ele_) {
        var dataUrl = $api.attr(ele_, 'data-url');
        if (dataUrl) {
            api.imageCache({
                url: dataUrl
            }, function(ret, err) {
                if (ret) {
                    ele_.src = ret.url;
                    $api.attr(ele_, 'data-url', '');
                }
            });
        }
    }
    //跳转到搜索页面
    function openSearch() {
        api.openWin({
            name: 'search',
            url: './search.html',
            reload: true,
            slidBackEnabled: false,
        });
    }
    // 跳转到商品详情页
    function openGood(is_detail, id) {
        // 判断是否可以查看详情页
        if (is_detail == 1) {
            api.openWin({
                name: 'good_details',
                url: './good_details.html',
                pageParam: {
                    id: id
                },
                reload: true,
                slidBackEnabled: false,
            });
        } else {
            api.toast({
                msg: '详情页暂未开放',
                duration: 2000,
                location: 'middle'
            });
        }
    }
    // 导航按钮跳转页面
    function toPage(id, cate_id, status) {
        // 1~8 跳转固定页面
        if (id >= 1 && id <= 8) {
            if (id == 1) {
                // 跳转收藏列表页面
                api.openWin({
                    name: 'collection',
                    url: './collection.html',
                    reload: true,
                    slidBackEnabled: false,
                });
                return;
            }
            if (id == 2) {
                // 跳转新品反馈页面
                api.openWin({
                    name: 'feedback',
                    url: './feedback.html',
                    reload: true,
                    slidBackEnabled: false,
                });
            }
            if (id == 3) {
                // 跳转常用列表页面
                api.openWin({
                    name: 'commonly',
                    url: './commonly.html',
                    reload: true,
                    slidBackEnabled: false,
                });
            }
            if (id == 4) {
                // 联系客服调起打电话功能
                api.call({
                    type: 'tel_prompt',
                    number: tel
                });
                return;
            }
            if (id == 5) {
                // 跳转默认分类页面不带ID
                api.openWin({
                    name: 'classify',
                    url: './classify.html',
                    reload: true,
                    slidBackEnabled: false,
                });
            }
            if (id == 6) {
                // 跳转确定下单页面
                api.openWin({
                    name: 'shopcart',
                    url: './shopcart.html',
                    reload: true,
                    slidBackEnabled: false,
                });
            }
            if (id == 7) {
                // 跳转订单页面
                api.openWin({
                    name: 'order',
                    url: './order.html',
                    reload: true,
                    slidBackEnabled: false,
                });
            }
            if (id == 8) {
                // 跳转我的页面
                api.openWin({
                    name: 'mine',
                    url: './mine.html',
                    reload: true,
                    slidBackEnabled: false,
                });
            }
        } else {
            if (status == 0) {
                api.toast({
                    msg: '商品分类已下架',
                    duration: 2000,
                    location: 'middle'
                });
                return;
            }
            // 跳转分类页面对应的一级分类下
            api.openWin({
                name: 'classify',
                url: './classify.html',
                reload: true,
                slidBackEnabled: false,
                pageParam: {
                    firstId: cate_id
                }
            });
        }
    }
    // 跳转分类页面
    function openClassify() {
        api.openWin({
            name: 'classify',
            url: './classify.html',
            reload: true,
            slidBackEnabled: false,
        });
    }
    // 跳转限时抢购页面
    function toSpike() {
        api.openWin({
            name: 'spike',
            url: './spike.html',
            reload: true,
            slidBackEnabled: false,
        });
    }
    // 跳转购物车页面
    function openShopCart() {
        api.openWin({
            name: 'shopcart',
            url: './shopcart.html',
            reload: true,
            slidBackEnabled: false,
        });
    }
    // 跳转订单页面
    function openOrder() {
        api.openWin({
            name: 'order',
            url: './order.html',
            reload: true,
            slidBackEnabled: false,
        });
    }
    // 跳转我的页面
    function openMine() {
        api.openWin({
            name: 'mine',
            url: './mine.html',
            reload: true,
            slidBackEnabled: false,
        });
    }
</script>

</html>
