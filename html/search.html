<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>搜索页面-内容</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../css/index.css" />
    <link rel="stylesheet" type="text/css" href="../css/search.css" />
    <link rel="stylesheet" type="text/css" href="../css/jianpan.css" />
    <link rel="stylesheet" type="text/css" href="../css/no_goods.css" />
    <style>
        .bsx {
            display: none;
        }

        .sx {
            display: block;
        }

        #covers {
            position: absolute;
            left: 0px;
            top: 0px;
            background: rgba(0, 0, 0, 0.4);
            width: 100%;
            filter: alpha(opacity=60);
            opacity: 0.6;
            display: none;
            z-Index: 999;
            height: 400px;
            z-index: 99999999999999;
        }

        #coverss {
            position: absolute;
            left: 0px;
            top: 0px;
            background: rgba(0, 0, 0, 0.4);
            width: 100%;
            filter: alpha(opacity=60);
            opacity: 0.6;
            display: none;
            z-Index: 999;
            height: 400px;
            z-index: 99999999999999;
        }

        .gcaidjsl_list ol li .gcaidjsl_list_r address.on {
            color: #999;
        }

        .del {
            font-size: 13px;
            color: #999;
            margin-left: 0.1rem;
            font-weight: 400;
            text-decoration: line-through;
            display: none;
        }

        .del span {
            font-size: 13px;
            color: #999;
            margin-left: 0.1rem;
            font-weight: 400;
            text-decoration: line-through;
        }
    </style>
</head>

<body>
    <!-- 头部 -->
    <header class="aui-bar aui-bar-nav" id="header" style="background:white;position:fixed;top:0;left:0">
        <div class="aui-title" style="left:1rem; right: 2rem;">
            <div class="aui-searchbar" style="width: 95%;">
                <div class="aui-searchbar-input aui-border-radius" style="background-color: #f5f5f5;border-radius: 39px;">
                    <i class="aui-iconfont aui-icon-search"></i>
                    <input type="search" placeholder="请输入搜索内容" id="search-input" onfocus="getSearchData();">
                    <div class="aui-searchbar-clear-btn">
                        <i class="aui-iconfont aui-icon-close"></i>
                    </div>
                </div>
                <div class="aui-searchbar-btn" tapmode>取消</div>
            </div>
        </div>
        <div class="aui-pull-right aui-btn searchItem" tampode>
            <span class="aui-iconfont" style="color:#09bb07;right: 0.5rem;">搜索</span>
        </div>
    </header>
    <!-- 热门搜索 -->
    <div class="hotS bsx" style="margin-top:70px;">
        <p>热门搜索</p>
        <div class="hotS_lei">
            <!-- <div>小白菜</div> -->
        </div>
    </div>
    <!-- 商品列表 -->
    <div class="gcaidjsl_list gcaidjsl_seg gcaidjsl_psp goodsList" style="margin-top:70px;margin-bottom: 70px;">
        <ol class="list">
            <!-- <li data-item_idp="5" data-indexp="0">
                <section class="gcaidjsl_list_l">
                    <a href="javascript:;" class="gcaidjimg_po">
                        <img src="../image/Vc1J8Zd9k4loYqHbORFVztgmJxSVkqXtdDoSf0sf.jpeg" alt="" class="gcaidjimg_poi">
                    </a>
                    <span class="daily_img1">
                        <img src="../image/726Yn0GUJ6U7KgPTC2J1SLWCkNao00BIpxk4ArdO.png" alt="">
                    </span>
                    <span class="daily_xi1">
                        <span></span>
                        <strong class="daily_xis">扶贫</strong>
                    </span>
                </section>
                <section class="gcaidjsl_list_r">
                    <cite>
                        <a href="javascript:;" class="">大白菜.</a>
                    </cite>
                    <address class="vueappsy_add on">小白菜</address>
                    <section class="gcaidjsl_list_jg">
                        <section class="gcaidjsl_list_lt">￥1.00~8.00</section>
                        <section data-item_id="5" class="gcaidjsl_list_ge" tampode onclick="fnOpenShopCar()">
                            <i class="iconfont"><img src="../image/shopcar.jpg" alt=""></i>
                        </section>
                    </section>
                </section>
                <section class="clear"></section>
            </li> -->
        </ol>
    </div>
    <!-- 底部 -->
    <footer id="foot" class="aui-bar aui-bar-tab" style="border-top: 1px solid #ccc;">
        <div class="aui-bar-tab-item" style="width: 3.5rem;border-right: 1px solid #ccc;" id="footCart">
            <div class="aui-badge countNum" style="background:#f0b411;">0</div>
            <i class="aui-iconfont aui-icon-comment aui-icon-cart"></i>
            <div class="aui-bar-tab-label">购物车</div>
        </div>
        <div class="aui-bar-tab-item aui-bg-warning aui-text-white" tapmode style="width: auto;color:black !important;background:white !important;font-size: 0.7rem;">
            合计
            <span class="price countPrice">￥0.00</span>
            <span class="del">￥<span class="countDel">111</span></span>
        </div>
        <div class="aui-bar-tab-item aui-bg-danger aui-text-white goShopCar" tapmode style="width: 28%;background: #f56556 !important;">去结算</div>
    </footer>
    <!-- 多规格添加遮罩层 -->
    <div id="covers" tampode onclick="closeWin()"></div>
    <div id="modal" class="gcaidjh_ge" style="height: 333px;overflow: scroll;margin-bottom: 51px;">
        <div class="#modalb" style="margin-top: 20px;" id="modalbs">
            <!-- <input type="hidden" id="attr_id" value="0">
            <section class="gcaidjh_gei" style="margin: 0 auto;">
                <section class="gcaidjh_gei_l"><img src="../image/Jzz5770Jj9wr2w3P3MJXsK33X2A78jdOF9rgei0X.jpeg" alt=""></section>
                <section class="gcaidjh_gei_o">
                    <cite>黄豆芽</cite>
                    <address class="vueappsy_add">清热解毒,利尿除湿</address>
                    <input type="hidden" value="￥时价" class="gcaidjd_djg_i">
                    <aside class="gcaidjd_djg">￥2.00元/斤</aside>
                </section>
                <section class="gcaidjh_gei_r" tampode onclick="closeWin()"><img src="../image/gcaidj_pic6.png" alt=""></section>
                <section class="clear"></section>
                <p style="padding-top: 10px;font-size: 0.8rem;">选择规格</p>
            </section> -->
        </div>
    </div>
    <!-- 购物车弹窗 -->
    <div id="coverss" tampode onclick="closeCart()"></div>
    <div id="cart">
        <div class="gcaidjsl_list gcaidjsl_seg gcaidjsl_psp shopCarList">
            <!-- <ol>
                <div class="mar">
                    <span class="leibie">类别</span>
                    <span class="zhonglei">蔬菜类&nbsp;(1)</span>
                </div>
                <li data-item_idp="2" data-indexp="1" style="border-bottom:none;">
                    <section class="gcaidjsl_list_l">
                        <a href="javascript:;" class="gcaidjimg_po" style="border: 1px solid #f0f0f0;">
                            <img src="../image/Vc1J8Zd9k4loYqHbORFVztgmJxSVkqXtdDoSf0sf.jpeg" alt="" class="gcaidjimg_poi">
                        </a>
                        <section class="daily_img1">
                            <img src="../image/726Yn0GUJ6U7KgPTC2J1SLWCkNao00BIpxk4ArdO.png" alt="">
                        </section>
                        <span class="daily_xi1">
                            <span></span>
                            <strong class="daily_xis">扶贫</strong>
                        </span>
                    </section>
                    <section class="gcaidjsl_list_r">
                        <div class="g_title">
                            <div class="g_gtitle">
                                <cite>
                                    <a href="javascript:;" class="">白菜</a>
                                </cite>
                                <address class="vueappsy_add on">线椒颜色鲜艳,辣性强。线椒颜色鲜艳,辣性强。线椒颜色鲜艳,辣性强。</address>
                            </div>
                            <div class="g_img"><img src="../image/del.png" alt="" width="100%" height="100%"></div>
                        </div>
                        <section class="gcaidjsl_list_jg">
                            <section class="gcaidjsl_list_lt">￥4.00/斤</section>
                            <section class="gcaidj_sl">
                                <ruby data-val="1" data-item_id="2" data-attr_id="0" data-index="1" class="gcaidj_sls gcaidj_sln g_jians">
                                    <img src="../image/gcaidj_pic7.png" alt="">
                                </ruby>
                                <input type="text" data-item_id="2" data-attr_id="0" data-index="1" class="gcaidj_sli g_zhis t-keybord" value="1">
                                <ruby data-item_id="2" data-attr_id="0" data-val="1" data-index="1" class="gcaidj_sla g_jias">
                                    <img src="../image/gcaidj_pic8.png" alt="">
                                </ruby>
                            </section>
                        </section>
                    </section>
                    <section class="clear"></section>
                </li>
            </ol> -->
        </div>
    </div>
    <!-- 数值键盘遮罩层 -->
    <div id="coverd"></div>
    <div id="t-keybord">
        <div class="numbers-content">
            <div class="numbers-txt-ba2">
                <!-- <div class="numbers-title">最大数量<span class="sum2">999</span></div> -->
            </div>
            <div class="numbers-txt-ba">
                <div class="numbers-txt-box"><span class="numbers-txts"></span><em class="numbers-txte">122</em></div>
                <div class="numbers-txt-cler">
                    <div class="clear-text" id="t-del"><img src="../image/del1.png" alt=""></div>
                </div>
            </div>
            <div class="clear"></div>
            <div class="numbers-txt-ba1">
                <div class="numbers-btn-group">
                    <button type="button" value="1" class="sum-btn-value" onmousedown="sumBtnValue(this);">1</button>
                    <button type="button" value="2" class="sum-btn-value" onmousedown="sumBtnValue(this);">2</button>
                    <button type="button" value="3" class="sum-btn-value" onmousedown="sumBtnValue(this);">3</button>
                    <button type="button" value="4" class="sum-btn-value" onmousedown="sumBtnValue(this);">4</button>
                    <button type="button" value="5" class="sum-btn-value" onmousedown="sumBtnValue(this);">5</button>
                    <button type="button" value="6" class="sum-btn-value" onmousedown="sumBtnValue(this);">6</button>
                    <button type="button" value="7" class="sum-btn-value" onmousedown="sumBtnValue(this);">7</button>
                    <button type="button" value="8" class="sum-btn-value" onmousedown="sumBtnValue(this);">8</button>
                    <button type="button" value="9" class="sum-btn-value" onmousedown="sumBtnValue(this);">9</button>
                    <button type="button" value="0" class="sum-btn-value" onmousedown="sumBtnValue(this);">0</button>
                    <button type="button" value="." class="sum-btn-value wrap_xsd" onmousedown="sumBtnValue(this);">.</button>
                    <button type="button" value="" class="sum-btn-value"></button>
                    <!-- <span class="wrap_ys"></span> -->
                    <spanclass="wrap_xsd1" style="display: none;">
                        </span>
                </div>
                <div class="cifg-btn">
                    <div class="cifg-btn-confirm modifymi_qk" id="t-clear">清空</div>
                    <div class="cifg-btn-confirm cancel-btn" id="t-close">取消</div>
                    <div class="clear"></div>
                    <div class="cifg-btn-confirm1 modifymi_con" id="t-submit">确认</div>
                </div>
            </div>
        </div>
    </div>
    <!-- 返回首页按钮 -->
    <div class="shouye" id="div" tampode onclick="openIndex()"></div>
    <!-- 无商品列表 -->
    <div class="wu bxs">
        <div style='height: 10px;background: #f5f5f5;'></div>
        <section class="gcaidjfi_spr_b gcaidjsl_psp">
            <section class="placewr_ws">
                <img src="../image/wjl.png" alt="">
                <cite>亲，目前暂无数据～</cite>
            </section>
        </section>
    </div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="../script/jianpan_search.js"></script>
<script type="text/javascript" src="../script/md5.js"></script>
<script type="text/javascript" src="../script/regular.js"></script>
<script type="text/javascript" src="../script/encipherment.js"></script>
<script type="text/javascript" src="../script/date.js"></script>
<script type="text/javascript">
    var keyword = "";
    var attr_Id = "";
    var cartNums = 0;
    apiready = function() {
        //修改手机状态栏字体颜色
        api.setStatusBarStyle({
            style: 'dark'
        });
        //头部沉浸式效果
        var header = $api.byId('header');
        $api.fixStatusBar(header);
        var timeStamp = timestamp();
        getSearchData();
        // 获取购物车数量
        var sign = getSign("appid=" + $api.getStorage("appid") + "&timeStamp=" + timeStamp);
        api.ajax({
            url: $api.getStorage("URL") + '/mobileOrder/getCountNum',
            returnAll: true,
            headers: {
                'Authorization': $api.getStorage('token')
            },
            method: 'GET',
            data: {
                values: {
                    appid: $api.getStorage("appid"),
                    active: 2,
                    timeStamp: timeStamp,
                    sign: sign
                }
            }
        }, function(ret, err) {
            if (ret) {
                judgement(ret.body.code, ret.msg)
                var body = ret.body;
                var headers = ret.headers;
                if (isNotEmpry(headers.Authorization)) {
                    $api.setStorage('token', headers.Authorization);
                }
                if (body.code == 200) {
                    changeCountNum(body.data)
                    if (isNotEmpry(body.data.countNum)) {
                        cartNums = body.data.countNum;
                        $api.html($api.dom(".countNum"), body.data.countNum);
                    }
                    // if (body.data.is_look == 1) {
                    //     $api.html($api.dom(".countPrice"), "￥" + body.data.countPrice);
                    // } else {
                    //     $api.html($api.dom(".countPrice"), "￥***");
                    // }
                } else {
                    api.toast({
                        msg: body.msg,
                        duration: 2000,
                        location: 'middle'
                    });
                }
            } else {
                api.toast({
                    msg: JSON.stringify(err),
                    duration: 2000,
                    location: 'middle'
                });
            }
        });
        // 十六．热门搜索
        api.ajax({
            url: $api.getStorage("URL") + '/mobileOrder/getSearchData',
            method: 'GET',
            returnAll: true,
            headers: {
                'Authorization': $api.getStorage('token')
            },
            data: {
                values: {
                    appid: $api.getStorage("appid"),
                    active: 2,
                    timeStamp: timeStamp,
                    sign: sign
                }
            }
        }, function(ret, err) {
            if (ret) {
                judgement(ret.body.code, ret.msg)
                var body = ret.body;
                var headers = ret.headers;
                if (isNotEmpry(headers.Authorization)) {
                    $api.setStorage('token', headers.Authorization);
                }
                if (body.code == 200) {
                    var data = body.data;
                    if (isNotEmpry(data) && data.length > 0) {
                        var listStr = "";
                        for (var i = 0; i < data.length; i++) {
                            data[i]
                            listStr += "<div onclick='getSearchItem(\"" + data[i].keywords + "\");'>" + data[i].keywords + "</div>";
                        }
                        $api.html($api.dom(".hotS_lei"), listStr);
                    }
                } else {
                    api.toast({
                        msg: body.msg,
                        duration: 2000,
                        location: 'middle'
                    });
                }
            } else {
                api.toast({
                    msg: JSON.stringify(err),
                    duration: 2000,
                    location: 'middle'
                });
            }
            api.hideProgress();
        });
        // 点击搜索
        $api.addEvt($api.dom(".searchItem"), 'click', function() {
            keyword = $api.val($api.byId("search-input"));
            if (!isNotEmpry(keyword)) {
                api.toast({
                    msg: "商品名称不能为空",
                    duration: 2000,
                    location: 'middle'
                });
                return;
            }
            // 搜索商品
            getSearchItem(keyword);
        });
        // 去结算
        $api.addEvt($api.dom(".goShopCar"), 'click', function() {
            api.openWin({
                name: 'shopcart',
                url: 'shopcart.html',
                reload: true,
                slidBackEnabled: false
            });
        });

        $("#search-input").on('keypress', function(e) {
            var keycode = e.keyCode;
            var searchName = $(this).val();
            if (keycode == '13') {
                keyword = $api.val($api.byId("search-input"));
                if (!isNotEmpry(keyword)) {
                    api.toast({
                        msg: "商品名称不能为空",
                        duration: 2000,
                        location: 'middle'
                    });
                    return;
                }
                // 搜索商品
                getSearchItem(keyword);
            }
        });
    };

    function changeCountNum(data) {
        if (data.is_look == 1) {
            if (data.activity_type == 1 && data.discount != 0) {
                $(".del").show()
                var money = (data.countPrice - data.discount).toFixed(2)
                $api.html($api.dom(".countPrice"), money);
                $api.html($api.dom(".countDel"), data.countPrice);
            } else {
                $(".del").hide()
                $api.html($api.dom(".countPrice"), data.countPrice);
            }

        } else {
            $(".del").hide()
            $api.html($api.dom(".countPrice"), "***");
        }
    }
    // 聚焦显示热词，屏蔽商品列表、无数据样式
    function getSearchData() {
        $api.addCls($api.dom(".hotS"), 'sx');
        $api.addCls($api.dom(".wu"), 'bxs');
        $api.addCls($api.dom(".goodsList"), 'bxs');
    }
    // 搜索商品
    var item_default;
    var is_look;

    function getSearchItem(keywords) {
        if (isNotEmpry(keywords)) {
            $api.val($api.byId("search-input"), keywords);
        } else {
            return;
        }
        api.showProgress({
            title: '努力加载中...',
            modal: false
        });
        var timeStamp = timestamp();
        var sign = getSign("appid=" + $api.getStorage("appid") + "&keyword=" + keywords + "&timeStamp=" + timeStamp);
        api.ajax({
            url: $api.getStorage("URL") + '/mobileOrder/getSearchItem',
            method: 'GET',
            headers: {
                'Authorization': $api.getStorage('token')
            },
            returnAll: true,
            data: {
                values: {
                    appid: $api.getStorage("appid"),
                    active: 2,
                    keyword: keywords,
                    timeStamp: timeStamp,
                    sign: sign
                }
            }
        }, function(ret, err) {
            if (ret) {
                judgement(ret.body.code, ret.msg)
                var body = ret.body;
                var headers = ret.headers;
                if (isNotEmpry(headers.Authorization)) {
                    $api.setStorage('token', headers.Authorization);
                }
                if (body.code == 200) {
                    var data = body.data;
                    var list = data.list;
                    item_default = data.item_default;
                    is_look = data.is_look;
                    if (isNotEmpry(list) && list.length > 0) {
                        $api.removeCls($api.dom(".hotS"), 'sx');
                        $api.removeCls($api.dom(".goodsList"), 'bxs');
                        var listStrs = "";
                        for (var i = 0; i < list.length; i++) {
                            listStrs += "<li>";
                            listStrs += "<section class='gcaidjsl_list_l'>";
                            listStrs += "<a href='javascript:;' class='gcaidjimg_po' tampode onclick='openGood(" + data.is_detail + "," + list[i].id + ");'>";
                            if (isNotEmpry(list[i].img)) {
                                listStrs += "<img src='" + $api.getStorage("URL") + list[i].img + "' class='gcaidjimg_poi' onerror='onerrors(this,\"" + data.item_default + "\");'>";
                            } else {
                                listStrs += "<img src='" + $api.getStorage("URL") + data.item_default + "' class='gcaidjimg_poi' onerror='onerrors(this,\"" + data.item_default + "\");'>";
                            }
                            listStrs += "</a>";
                            if (data.shuiyin == 1) {
                                listStrs += "<span class='daily_img1'>";
                                listStrs += "<img src='" + $api.getStorage("URL") + data.logo + "'>";
                                listStrs += "</span>";
                            }
                            if (isNotEmpry(list[i].label)) {
                                listStrs += "<span class='daily_xi1'>";
                                listStrs += "<span></span>";
                                listStrs += "<strong class='daily_xis'>" + list[i].label + "</strong>";
                                listStrs += "</span>";
                            }
                            listStrs += "</section>";
                            listStrs += "<section class='gcaidjsl_list_r'>";
                            listStrs += "<cite tampode onclick='openGood(" + data.is_detail + "," + list[i].id + ");'>";
                            listStrs += "<a href='javascript:;'>" + list[i].title + "</a>";
                            listStrs += "</cite>";
                            if (isNotEmpry(list[i].describe)) {
                                listStrs += "<address class='vueappsy_add on'>" + list[i].describe + "</address>";
                            } else {
                                listStrs += "<address class='vueappsy_add on'></address>";
                            }
                            listStrs += "<section class='gcaidjsl_list_jg'>";
                            // 判断是否显示价格
                            if (data.is_look == 1) {
                                // 判断是否有属性
                                if (isNotEmpry(list[i].attr)) {
                                    listStrs += "<section class='gcaidjsl_list_lt'>￥" + list[i].area_price + "</section>";
                                } else {
                                    // 判断是否参与活动
                                    if (list[i].is_activity == 1) {
                                        listStrs += "<section class='gcaidjsl_list_lt'>￥" + list[i].activity_price + "/" + list[i].unit + "</section>";
                                    } else {
                                        // 判断是否时价
                                        if (list[i].market_price == 1) {
                                            listStrs += "<section class='gcaidjsl_list_lt'>￥时价</section>";
                                        } else {
                                            listStrs += "<section class='gcaidjsl_list_lt'>￥" + list[i].price + "/" + list[i].unit + "</section>";
                                        }
                                    }
                                }
                            } else {
                                listStrs += "<section class='gcaidjsl_list_lt'>￥***</section>";
                            }
                            if (isNotEmpry(list[i].attr)) {
                                //  多规格
                                listStrs += "<section class='gcaidjsl_list_ge' tampode onclick='fnOpenShopCar(" + list[i].id + ")'>";
                                listStrs += '<i class="iconfont"><img src="../image/shopcar.jpg" alt=""></i>';
                                listStrs += '</section>';
                            } else {
                                listStrs += "<section class='gcaidj_sl'>";
                                if (isNotEmpry(list[i].cart_num)) {
                                    listStrs += "<ruby cart_num='" + list[i].cart_num + "' class='gcaidj_sls g_jians' tampode onclick='changeNum(1,this," + list[i].id + "," + JSON.stringify(list[i].attr) + ");'>";
                                    listStrs += "<img src='../image/gcaidj_pic7.png'>";
                                    listStrs += "</ruby>";
                                    listStrs += "<input style='width:90px;' type='text' data-float='" + list[i].is_float + "' onmousedown='keybord(this," + list[i].id + "," + JSON.stringify(list[i].attr) + ",\"" + keywords +
                                        "\");' readonly='readonly' class='gcaidj_sli g_zhis cartNum' value='" + list[i].cart_num + "'>";
                                    listStrs += "<ruby cart_num='" + list[i].cart_num + "' class='gcaidj_sla g_jias' tampode  onclick='changeNum(2,this," + list[i].id + "," + JSON.stringify(list[i].attr) + ");'>";
                                    listStrs += "<img src='../image/gcaidj_pic8.png'>";
                                    listStrs += "</ruby>";
                                } else {
                                    listStrs += "<ruby cart_num='" + list[i].cart_num + "' class='gcaidj_sls g_jians' style='display:none;' tampode onclick='changeNum(1,this," + list[i].id + "," + JSON.stringify(list[i].attr) + ");'>";
                                    listStrs += "<img src='../image/gcaidj_pic7.png'>";
                                    listStrs += "</ruby>";
                                    listStrs += "<input style='width:90px;' type='text' data-float='" + list[i].is_float + "' onmousedown='keybord(this," + list[i].id + "," + JSON.stringify(list[i].attr) + ",\"" + keywords +
                                        "\");' readonly='readonly' style='display:none;' class='gcaidj_sli g_zhis cartNum' value=''>";
                                    listStrs += "<ruby cart_num='" + list[i].cart_num + "' class='gcaidj_sla g_jias' tampode  onclick='changeNum(2,this," + list[i].id + "," + JSON.stringify(list[i].attr) + ");'>";
                                    listStrs += "<img src='../image/gcaidj_pic8.png'>";
                                    listStrs += "</ruby>";
                                }
                                listStrs += "</section>";
                            }
                            listStrs += "</section>";
                            listStrs += "</section>";
                            listStrs += "<section class='clear'></section>";
                            listStrs += "</li>";
                        }
                        $api.html($api.dom(".list"), listStrs);
                    } else {
                        $api.removeCls($api.dom(".hotS"), 'sx');
                        $api.removeCls($api.dom(".wu"), 'bxs');
                    }
                } else {
                    api.toast({
                        msg: body.msg,
                        duration: 2000,
                        location: 'middle'
                    });
                }
            } else {
                api.toast({
                    msg: JSON.stringify(err),
                    duration: 2000,
                    location: 'middle'
                });
            }
            api.hideProgress();
        });
    }
    // 多规格弹窗
    function fnOpenShopCar(id) {
        attr_Id = id;
        // alert(attr_Id)
        var timeStamp = timestamp();
        var sign = getSign("appid=" + $api.getStorage("appid") + "&timeStamp=" + timeStamp + "&id=" + attr_Id);
        api.ajax({
            url: $api.getStorage("URL") + '/mobileOrder/getItemById',
            method: 'GET',
            headers: {
                'Authorization': $api.getStorage('token')
            },
            returnAll: true,
            data: {
                values: {
                    appid: $api.getStorage("appid"),
                    active: 2,
                    id: attr_Id,
                    timeStamp: timeStamp,
                    sign: sign
                }
            }
        }, function(ret, err) {
            if (ret) {
                judgement(ret.body.code, ret.msg)
                var body = ret.body;
                var headers = ret.headers;
                if (isNotEmpry(headers.Authorization)) {
                    $api.setStorage('token', headers.Authorization);
                }
                if (body.code == 200) {
                    var list = body.data;
                    // console.log(JSON.stringify(list))
                    $("#covers").show();
                    $("#modal").show();
                    var h = $(document.body).height();
                    $("#covers").css("height", 800);
                    $("body").addClass("gun");
                    var attr = list.attr;
                    var str = '';
                    str += '<input type="hidden" id="attr_id" value="' + list.id + '">';
                    str += '<section class="gcaidjh_gei" style="margin: 0 auto;">';
                    if (isNotEmpry(list.img)) {
                        str += '<section class="gcaidjh_gei_l"><img src="' + $api.getStorage("URL") + list.img + '" alt="" onerror="(this,\'' + item_default + '\')"></section>'
                    } else {
                        str += '<section class="gcaidjh_gei_l"><img src="' + $api.getStorage("URL") + item_default + '" alt="" onerror="(this,\'' + item_default + '\')"></section>';
                    }
                    str += '<section class="gcaidjh_gei_o">';
                    str += '<cite>' + list.title + '</cite>';
                    if (isNotEmpry(list.describe)) {
                        str += "<address class='vueappsy_add on' tampode onclick='openDescribe(" + JSON.stringify(list.describe) + ")'>" + list.describe + "</address>";
                    } else {
                        str += "<address class='vueappsy_add on' tampode onclick='openDescribe(" + JSON.stringify(list.describe) + ")'></address>";
                    }
                    str += '<input type="hidden" value="￥时价" class="gcaidjd_djg_i">';
                    // 判断是否可以查看价格 0否1是
                    if (is_look == 1) {
                        if (isNotEmpry(attr)) {
                            // 如果没有参与活动 则判断是否开启时价 0否1是
                            if (list.market_price == 1) {
                                str += '<aside class="gcaidjd_djg">￥时价</aside>';
                            } else {
                                str += '<aside class="gcaidjd_djg">￥' + list.area_price + '</aside>';
                            }

                        } else {
                            // 判断该商品是否参与活动 0否1是 如果是则显示活动价格
                            if (list.is_activity == 1) {
                                str += '<aside class="gcaidjd_djg">￥' + list.activity_price + '/' + list.unit + '</aside>';
                            } else {
                                // 如果没有参与活动 则判断是否开启时价 0否1是
                                if (list.market_price == 1) {
                                    str += '<aside class="gcaidjd_djg">￥时价</aside>';
                                } else {
                                    str += '<aside class="gcaidjd_djg">' + list.price + '/' + list.unit + '</aside>';
                                }
                            }
                        }
                    } else {
                        str += '<aside class="gcaidjd_djg">￥***</aside>';
                    }
                    str += '</section>';
                    str += '<section class="gcaidjh_gei_r" tampode onclick="closeWin()"><img src="../image/gcaidj_pic6.png" alt=""></section>';
                    str += '<section class="clear"></section>';
                    str += '<p style="padding-top: 10px;font-size: 0.8rem;">选择规格</p>';
                    str += '</section>';
                    // 多规格
                    if (isNotEmpry(attr)) {
                        for (var i = 0; i < attr.length; i++) {
                            str += '<section class="gcaidjh_geg">';
                            str += '<cite class="gou">' + attr[i].attr_title + '</cite>';

                            // 判断是否可以查看价格 0否1是
                            if (is_look == 1) {
                                // 判断该商品是否参与活动 0否1是 如果是则显示活动价格
                                if (attr[i].is_activity == 1) {
                                    // console.log(attr[i].activity_num)
                                    if (attr[i].cart_num > attr[i].activity_num) {
                                        str += '<address class="jia">￥' + attr[i].attr_price + '元/' + attr[i].unit + '<del>￥' + attr[i].attr_price + '</del></address>';
                                    } else {
                                        str += '<address class="jia">￥' + attr[i].activity_price + '元/' + attr[i].unit + '<del>￥' + attr[i].attr_price + '</del></address>';
                                    }
                                } else {
                                    // 如果没有参与活动 则判断是否开启时价 0否1是
                                    if (attr[i].market_price == 1) {
                                        str += '<address class="jia">￥时价</address>';
                                    } else {
                                        str += '<address class="jia">￥' + attr[i].attr_price + '元/' + attr[i].unit + '</address>';
                                    }
                                }
                            } else {
                                str += '<aside class="jia">￥***</aside>';
                            }



                            str += "<section class='gcaidj_sl gcaidj_sg'>";
                            if (isNotEmpry(attr[i].cart_num)) {
                                str += "<ruby cart_num='" + attr[i].cart_num + "' class='gcaidj_sls gcaidj_sln g_jians' tampode onclick='changeNum(1,this," + attr[i].item_id + "," + JSON.stringify(attr[i]) + ");'>";
                                str += "<img src='../image/gcaidj_pic7.png' alt=''>";
                                str += "</ruby>";
                                str += "<input style='width:90px;' type='text' readonly='readonly' value='" + attr[i].cart_num + "' data-float='" + attr[i].is_float + "' onmousedown='keybord(this," + list.id + "," + JSON.stringify(attr[i]) +
                                    ");' class='gcaidj_sli g_zhis t-keybord cartNum'>";
                                str += "<ruby cart_num='" + attr[i].cart_num + "' class='gcaidj_sla g_jias' tampode onclick='changeNum(2,this," + attr[i].item_id + "," + JSON.stringify(attr[i]) + ");'>";
                                str += "<img src='../image/gcaidj_pic8.png' alt=''>";
                                str += '</ruby>';
                            } else {
                                str += "<ruby cart_num='" + attr[i].cart_num + "' style='display:none;' class='gcaidj_sls gcaidj_sln g_jians' tampode onclick='changeNum(1,this," + attr[i].item_id + "," + JSON.stringify(attr[i]) + ");'>";
                                str += "<img src='../image/gcaidj_pic7.png' alt=''>";
                                str += "</ruby>";
                                str += "<input style='width:90px;' type='text' readonly='readonly' value='' data-float='" + attr[i].is_float + "' onmousedown='keybord(this," + list.id + "," + JSON.stringify(attr[i]) +
                                    ");' class='gcaidj_sli g_zhis t-keybord cartNum' style='display:none;'>";
                                str += "<ruby cart_num='" + attr[i].cart_num + "' class='gcaidj_sla g_jias' tampode onclick='changeNum(2,this," + attr[i].item_id + "," + JSON.stringify(attr[i]) + ");'>";
                                str += "<img src='../image/gcaidj_pic8.png' alt=''>";
                                str += '</ruby>';
                            }
                            str += '</section>';
                            str += '</section>';
                        }
                    }
                    $api.html($api.byId('modalbs'), str);
                } else {
                    api.toast({
                        msg: body.msg,
                        duration: 2000,
                        location: 'middle'
                    });
                }
            } else {
                api.toast({
                    msg: JSON.stringify(err),
                    duration: 2000,
                    location: 'middle'
                });
            }
            api.hideProgress();
        });
    }
    //关闭多规格弹窗
    function closeWin() {
        $("#covers").hide()
        $("#modal").hide()
        $("body").removeClass("gun");
        attr_Id = '';
    }
    //购物车弹窗
    $("#footCart").click(function(event) {  
        event.stopPropagation(); // 只执行button的click，如果注释掉该行，将执行button、p和div的click  
        getShopCratList()
    });

    function getShopCratList() {
        //判断是否登录
        if (!isNotEmpry($api.getStorage('token'))) {
            api.openWin({
                name: 'login',
                url: 'login.html',
                reload: true,
                slidBackEnabled: false
            });
        } else {
            //判断购物车是否为空
            if (cartNums == 0) {
                api.toast({
                    msg: '购物车为空',
                    duration: 2000,
                    location: 'middle'
                });
            } else {
                $("#coverss").show();
                $("#cart").show();
                var h = $(document.body).height();
                $("#coverss").css("height", 800);
                $("body").addClass("gun");
                // 获取购物车商品列表
                fnOpenShopCart();
            }
        }
    }
    //关闭购物车弹窗
    function closeCart() {
        $("#coverss").hide()
        $("#cart").hide()
        $("body").removeClass("gun");
    }



    //购物车弹窗
    function fnOpenShopCart() {
        var countNum = $api.html($api.dom(".countNum"));
        if (countNum == 0) {
            api.toast({
                msg: "购物车为空",
                duration: 2000,
                location: 'middle'
            });
            return;
        }

        var timeStamp = timestamp();
        // 获取购物车商品列表
        var sign = getSign("appid=" + $api.getStorage("appid") + "&timeStamp=" + timeStamp);
        api.ajax({
            url: $api.getStorage("URL") + '/mobileOrder/openCart',
            method: 'GET',
            headers: {
                'Authorization': $api.getStorage('token')
            },
            returnAll: true,
            data: {
                values: {
                    appid: $api.getStorage("appid"),
                    active: 2,
                    timeStamp: timeStamp,
                    sign: sign
                }
            }
        }, function(ret, err) {
            if (ret) {
                judgement(ret.body.code, ret.msg)
                var body = ret.body;
                var headers = ret.headers;
                if (isNotEmpry(headers.Authorization)) {
                    $api.setStorage('token', headers.Authorization);
                }
                if (body.code == 200) {
                    // console.log(JSON.stringify(body.data))
                    var data = body.data;
                    var shop = data.shop;
                    if (isNotEmpry(shop) && shop.length > 0) {
                        var listStr = "";
                        for (var i = 0; i < shop.length; i++) {
                            listStr += "<ol>";
                            listStr += "<div class='mar'>";
                            listStr += "<span class='leibie'>类别</span>";
                            listStr += "<span class='zhonglei'>" + shop[i].p_name + "&nbsp;(" + shop[i].count + ")</span>";
                            listStr += "</div>";
                            var list = shop[i].list;
                            for (var j = 0; j < list.length; j++) {
                                listStr += "<li style='border-bottom:none;'>";
                                listStr += "<section class='gcaidjsl_list_l'>";
                                listStr += "<a href='javascript:;' class='gcaidjimg_po' style='border: 1px solid #f0f0f0;' tampode onclick='openGood(" + data.is_detail + "," + list[j].id + ");'>";
                                if (isNotEmpry(list[j].img)) {
                                    listStr += "<img src='" + $api.getStorage("URL") + list[j].img + "' class='gcaidjimg_poi' onerror='onerrors(this,\"" + data.item_default + "\");'>";
                                } else {
                                    listStr += "<img src='" + $api.getStorage("URL") + data.item_default + "' class='gcaidjimg_poi' onerror='onerrors(this,\"" + data.item_default + "\");'>";
                                }
                                listStr += "</a>";
                                if (data.shuiyin == 1) {
                                    listStr += "<section class='daily_img1'>";
                                    listStr += "<img src='" + $api.getStorage("URL") + data.logo + "'>";
                                    listStr += "</section>";
                                }
                                if (isNotEmpry(list[j].label)) {
                                    listStr += "<span class='daily_xi1'>";
                                    listStr += "<span></span>";
                                    listStr += "<strong class='daily_xis'>" + list[j].label + "</strong>";
                                    listStr += "</span>";
                                }
                                listStr += "</section>";
                                listStr += "<section class='gcaidjsl_list_r'>";
                                listStr += "<div class='g_title'>";
                                listStr += "<div class='g_gtitle'>";
                                listStr += "<cite>";
                                listStr += "<a href='javascript:;' tampode onclick='openGood(" + data.is_detail + "," + list[j].id + ");'>" + list[j].title + "</a>";
                                listStr += "</cite>";
                                if (isNotEmpry(list[j].describe)) {
                                    listStr += "<address class='vueappsy_add on'>" + list[j].describe + "</address>";
                                }
                                if (isNotEmpry(list[j].attr)) {
                                    listStr += "<section class='gcaidjgw_pol'>（" + list[j].attr.attr_title + "）</section>";
                                }
                                listStr += "</div>";
                                listStr += "<div class='g_img' onclick='deleteCart(this," + list[j].id + "," + JSON.stringify(list[j].attr) + ");'><img src='../image/del.png' width='100%' height='100%'></div>";
                                listStr += "</div>";
                                listStr += "<section class='gcaidjsl_list_jg'>";
                                // 判断是否显示价格
                                if (data.is_look == 1) {
                                    // 判断是否含有属性
                                    if (isNotEmpry(list[j].attr)) {
                                        // 判断属性是否参与活动
                                        if (list[j].attr.is_activity == 1) {
                                            if (list[j].cart_num > list[j].attr.activity_num) {
                                                listStr += "<section class='gcaidjsl_list_lt'>￥" + list[j].attr.attr_price + "/" + list[j].attr.unit + "</section>"
                                                listStr += "<span>(已选" + list[j].attr.attr_title + ")</span>";
                                            } else {
                                                listStr += "<section class='gcaidjsl_list_lt'>￥" + list[j].attr.activity_price + "/" + list[j].attr.unit + "</section>"
                                                listStr += "<del class='gcaidjsl_del'>" + list[j].attr.attr_price + "</del>"
                                                listStr += "<span>(已选" + list[j].attr.attr_title + ")</span>";
                                            }
                                        } else {
                                            // 判断属性是否显示时价
                                            if (list[j].attr.market_price == 1) {
                                                listStr += "<section class='gcaidjsl_list_lt'>￥时价</section>";
                                            } else {
                                                listStr += "<section class='gcaidjsl_list_lt'>￥" + list[j].attr.attr_price + "/" + list[j].attr.unit + "</section>";
                                            }
                                        }
                                    } else {
                                        // 判断商品是否参与活动
                                        if (list[j].is_activity == 1) {
                                            if (list[j].cart_num > list[j].activity_num) {
                                                listStr += "<section class='gcaidjsl_list_lt'>￥" + list[j].price + "/" + list[j].unit + "</section>"
                                                listStr += "<span>(已选" + list[j].title + ")</span>";
                                            } else {
                                                listStr += "<section class='gcaidjsl_list_lt'>￥" + list[j].activity_price + "/" + list[j].unit + "</section>"
                                                listStr += "<del class='gcaidjsl_del'>" + list[j].price + "</del>"
                                                listStr += "<span>(已选" + list[j].title + ")</span>";
                                            }
                                        } else {
                                            // 判断是否显示时价
                                            if (list[j].market_price == 1) {
                                                listStr += "<section class='gcaidjsl_list_lt'>￥时价</section>";
                                            } else {
                                                listStr += "<section class='gcaidjsl_list_lt'>￥" + list[j].price + "/" + list[j].unit + "</section>";
                                            }
                                        }
                                    }
                                } else {
                                    listStr += "<section class='gcaidjsl_list_lt'>￥***</section>";
                                }
                                listStr += "<section class='gcaidj_sl'>";
                                listStr += "<ruby cart_num='" + list[j].cart_num + "' class='gcaidj_sls gcaidj_sln g_jians' tampode onclick='changeNum(1,this," + list[j].id + "," + JSON.stringify(list[j].attr) + ");'>";
                                listStr += "<img src='../image/gcaidj_pic7.png'>";
                                listStr += "</ruby>";
                                listStr += "<input style='width:90px;' type='text' data-float='" + list[j].is_float + "' onmousedown='keybord(this," + list[j].id + "," + JSON.stringify(list[j].attr) + ",\"" + keyword +
                                    "\");' class='gcaidj_sli g_zhis cartNum' value='" + list[j].cart_num + "' readonly>";
                                listStr += "<ruby cart_num='" + list[j].cart_num + "' class='gcaidj_sla g_jias' tampode  onclick='changeNum(2,this," + list[j].id + "," + JSON.stringify(list[j].attr) + ");'>";
                                listStr += "<img src='../image/gcaidj_pic8.png'>";
                                listStr += "</ruby>";
                                listStr += "</section>";
                                listStr += "</section>";
                                listStr += "</section>";
                                listStr += "<section class='clear'></section>";
                                if (isNotEmpry(list[j].attr)) {
                                    if (list[j].attr.is_activity == 1) {
                                        if (list[j].cart_num > list[j].attr.activity_num) {
                                            listStr += "<div class='gcaidjsl_xg'>限购数量：" + list[j].attr.activity_num + "，已恢复原价</div>"
                                        }
                                    }
                                } else {
                                    if (list[j].is_activity == 1) {
                                        if (list[j].cart_num > list[j].activity_num) {
                                            listStr += "<div class='gcaidjsl_xg'>限购数量：" + list[j].activity_num + "，已恢复原价</div>"
                                        }
                                    }
                                }
                                listStr += "</li>";
                            }
                            listStr += "</ol>";
                        }
                        $api.html($api.dom(".shopCarList"), listStr);
                        // $("#coverss").show();
                        // $("#cart").show();
                        // $("#coverss").css("height", 400);
                        // $("body").addClass("gun");
                    }
                } else {
                    api.toast({
                        msg: body.msg,
                        duration: 2000,
                        location: 'middle'
                    });
                }
            } else {
                api.toast({
                    msg: JSON.stringify(err),
                    duration: 2000,
                    location: 'middle'
                });
            }
            api.hideProgress();
        });
    }
    //关闭多规格弹窗
    function closeCart() {
        $("#coverss").hide()
        $("#cart").hide()
        $("body").removeClass("gun");
    }
    // 更新购物车数量
    function changeNum(falg, obj, id, attr) {
        if (isNotEmpry($api.getStorage('token'))) {
            var cartNum = $(obj).siblings(".cartNum").val();
            // falg 增减判断标识 1减2加
            if (falg == 1) {
                cartNum--;
            } else {
                $(obj).siblings("ruby").show();
                $(obj).siblings("input").show();
                cartNum++;
            }
            var attrId = 0;
            if (isNotEmpry(attr)) {
                attrId = attr.id;
            }
            // 删除购物车商品
            if (cartNum == 0) {
                // 删除购物车商品
                deleteCart(obj, id, attr);
                $(obj).hide();
                $(obj).siblings("input").hide();
            } else {
                var timeStamp = timestamp();
                var sign = getSign("appid=" + $api.getStorage("appid") + "&attr_id=" + attrId + "&item_num=" + cartNum + "&item_id=" + id + "&timeStamp=" + timeStamp);
                api.showProgress({
                    title: '努力加载中...',
                    modal: false
                });
                api.ajax({
                    url: $api.getStorage("URL") + '/mobileOrder/changeNum',
                    method: 'POST',
                    headers: {
                        'Authorization': $api.getStorage('token')
                    },
                    returnAll: true,
                    data: {
                        values: {
                            appid: $api.getStorage("appid"),
                            active: 2,
                            attr_id: attrId,
                            item_num: cartNum,
                            item_id: id,
                            timeStamp: timeStamp,
                            sign: sign
                        }
                    }
                }, function(ret, err) {
                    if (ret) {
                        judgement(ret.body.code, ret.msg)
                        var body = ret.body;
                        var headers = ret.headers;
                        if (isNotEmpry(headers.Authorization)) {
                            $api.setStorage('token', headers.Authorization);
                        }
                        if (body.code == 200) {
                            changeCountNum(body.data)
                            $api.html($api.dom(".countNum"), body.data.countNum);
                            // 判断是否显示价格 0否1是
                            // if (body.data.is_look == 1) {
                            //     $api.html($api.dom(".countPrice"), "￥" + body.data.countPrice);
                            // } else {
                            //     $api.html($api.dom(".countPrice"), "￥***");
                            // }
                            $(obj).siblings(".cartNum").val(cartNum);
                            fnOpenShopCart();
                            if (attr_Id != '') {
                                fnOpenShopCar(attr_Id)
                            }
                        } else {
                            api.toast({
                                msg: body.msg,
                                duration: 2000,
                                location: 'middle'
                            });
                        }
                    } else {
                        api.toast({
                            msg: JSON.stringify(err),
                            duration: 2000,
                            location: 'middle'
                        });
                    }
                    api.hideProgress();
                });
            }
        } else {
            api.openWin({
                name: 'login',
                url: 'login.html',
                reload: true,
                slidBackEnabled: false
            });
        }
    }
    // 删除购物车商品
    function deleteCart(obj, id, attr) {
        var attrId = 0;
        if (isNotEmpry(attr)) {
            attrId = attr.id;
        }
        api.showProgress({
            title: '努力加载中...',
            modal: false
        });
        var timeStamp = timestamp();
        var sign = getSign("appid=" + $api.getStorage("appid") + "&attr_id=" + attrId + "&item_id=" + id + "&timeStamp=" + timeStamp);
        api.ajax({
            url: $api.getStorage("URL") + '/mobileOrder/deleteCart',
            method: 'POST',
            headers: {
                'Authorization': $api.getStorage('token')
            },
            returnAll: true,
            data: {
                values: {
                    appid: $api.getStorage("appid"),
                    active: 2,
                    attr_id: attrId,
                    item_id: id,
                    timeStamp: timeStamp,
                    sign: sign
                }
            }
        }, function(ret, err) {
            if (ret) {
                judgement(ret.body.code, ret.msg)
                var body = ret.body;
                var headers = ret.headers;
                if (isNotEmpry(headers.Authorization)) {
                    $api.setStorage('token', headers.Authorization);
                }
                if (body.code == 200) {
                    changeCountNum(body.data)
                    $api.html($api.dom(".countNum"), body.data.countNum);
                    // if (isNotEmpry(body.data.is_look)) {
                    //     if (body.data.is_look == 1) {
                    //         $api.html($api.dom(".countPrice"), "￥" + body.data.countPrice);
                    //     } else {
                    //         $api.html($api.dom(".countPrice"), "￥***");
                    //     }
                    // } else {
                    //     $api.html($api.dom(".countPrice"), "￥0.00");
                    // }
                    fnOpenShopCart();
                } else {
                    api.toast({
                        msg: body.msg,
                        duration: 2000,
                        location: 'middle'
                    });
                }
            } else {
                api.toast({
                    msg: JSON.stringify(err),
                    duration: 2000,
                    location: 'middle'
                });
            }
            api.hideProgress();
        });
    }
    // 跳转首页
    function openIndex() {
        api.openWin({
            name: 'index',
            url: './index.html',
            reload: true,
            slidBackEnabled: false
        });
    }
    // 跳转到商品详情页
    function openGood(is_detail, id) {
        // 判断是否可以查看详情页
        if (is_detail == 1) {
            api.openWin({
                name: 'good_details',
                url: 'good_details.html',
                pageParam: {
                    id: id
                },
                reload: true,
                slidBackEnabled: false,
            });
        } else {
            api.toast({
                msg: '详情页暂未开放',
                duration: 2000,
                location: 'middle'
            });
        }
    }
</script>

</html>
